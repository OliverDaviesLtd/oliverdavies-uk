workspace('oliverdavies-uk'):
  description: My personal website codebase.

attribute('database'):
  database: drupal
  password: drupal
  username: drupal
attribute('drupal.docroot'): web
attribute('frontend'):
  build: npm run prod
  dev: npm run dev
  install: npm ci
  path: themes/custom/opdavies
  watch: npm run watch
attribute('mysql'):
  image: mariadb
  version: 10
attribute('node.version'): 12
attribute('php.version'): 7.4

confd('workspace:/tools/workspace/confd'):
  - { src: 'docker-compose.yaml', dst: 'workspace:/docker-compose.yaml' }
  - { src: 'Dockerfile', dst: 'workspace:/Dockerfile' }
  - { src: 'settings.local.php', dst: 'workspace:/web/sites/default/settings.local.php' }
  - { src: 'vhost.conf', dst: 'workspace:/tools/.docker/images/nginx/vhost.conf' }

command('apply config'): |
  #!php
  $ws->confd('workspace:/tools/workspace/confd')->apply();

command('composer %'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|=
    ws exec composer ={ input.argument('%') }

command('disable'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash
    run docker-compose down --remove-orphans

command('drush %'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|=
    ws exec bin/drush ={ input.argument('%') }

command('enable'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash
    run docker-compose up -d --build

command('exec %'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|=
    passthru docker-compose exec php ={ input.argument('%') }

command('install'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash
    ws composer install
    ws theme install
    ws theme dev

command('frontend dev'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|@
    passthru docker-compose run --rm -w /node/@('frontend.path') node @('frontend.dev')

command('frontend build'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|@
    passthru docker-compose run --rm -w /node/@('frontend.path') node @('frontend.build')

command('frontend install'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|@
    passthru docker-compose run --rm -w /node/@('frontend.path') node @('frontend.install')

command('frontend watch'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|@
    passthru docker-compose run --rm -w /node/@('frontend.path') node @('frontend.watch')

command('phpunit %'):
  env:
    COMPOSE_PROJECT_NAME: = @('namespace')
  exec: |
    #!bash|=
    ws exec bin/phpunit ={ input.argument('%') }
